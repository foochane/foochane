---
title: JVM笔记：运行时数据区-程序计数器（PC寄存器）
date: 2020-6-16 13:36
urlname: 2020061601
categories: Java
tags:
  - Java
  - JVM
author: foochane
toc: true
mathjax: true
top: false
top_img: /images/banner/0.jpg
cover: /images/cover/14.jpg
---



## 1 程序计数器作用
![image.png](https://cdn.nlark.com/yuque/0/2020/png/910643/1593586195045-19987b6a-0f18-4cea-aa67-a180be100ba8.png)<br />
<br />![image.png](https://cdn.nlark.com/yuque/0/2020/png/910643/1593586302461-a5b0f928-cfa4-42f6-a4f7-ee9b648143f3.png)<br />

- 它是一块很小的内存空间， 几乎可以忽略不记。也是运行速度最快的存储区域。
- 在JVM 规范中， 每个线程都有它自己的程序计数器， 是线程私有的， 生命周期与线程的生命周期保持一致。
- 任何时间一个线程都只有一个方法在执行， 也就是所谓的当前方法。程序计数器会存储当前线程正在执行的Java 方法的JVM指令地址： 或者，如果是在执行native方法， 则是未指定值(undefned)
- 它是程序控制流的指示器， 分支、循环、跳转、异常处理、线程恢复等基础功能都需要依赖这个计数器来完成。
- 字节码解释器工作时就是通过改变这个计数器的值来选取下一条需要执行的字节码指令。
- 它是唯一一个在Java 虚拟机规范中没有规定任何0utOfMemoryError情况的区域。



行号指示器，游标<br />

## 2 代码示例
利用javap -v xxx.class反编译字节码文件，查看指令等信息<br />![](https://cdn.nlark.com/yuque/0/2020/webp/910643/1593586792472-5951bae3-ac50-4b3b-8d22-9d633206c64e.webp#align=left&display=inline&height=661&margin=%5Bobject%20Object%5D&originHeight=661&originWidth=931&size=0&status=done&style=none&width=931)<br />

<a name="IgiOq"></a>
### 2.1  常见问题
1.使用PC寄存器存储字节码指令地址有什么用呢？/ 为什么使用PC寄存器记录当前线程的执行地址呢？<br />**<br />因为CPU需要不停的切换各个线程，这时候切换回来以后，就得知道接着从哪开始继续执行JVM的字节码解释器就需要通过改变PC寄存器的值来明确下一条应该执行什么样的字节码指令<br />

![image.png](https://cdn.nlark.com/yuque/0/2020/png/910643/1593587302394-bedc6ebd-887b-4163-8970-43a35deedbc9.png)<br />
<br />
<br />2.PC寄存器为什么会设定为线程私有？<br />
<br />我们都知道所谓的多线程在一个特定的时间段内指回执行其中某一个线程的方法，CPU会不停地做任务切换，这样必然会导致经常中断或恢复，如何保证分毫无差呢？**为了能够准确地记录各个线程正在执行的当前字节码指令地址，最好的办法自然是为每一个线程都分配一个PC寄存器,**这样一来各个线程之间便可以进行独立计算，从而不会出现相互干扰的情况。<br />由于CPU时间片轮限制，众多线程在并发执行过程中，任何一个确定的时刻，一个处理器或者多核处理器中的一个内核，只会执行某个线程中的一条指令。<br />这样必然导致经常中断或恢复，如何保证分毫无差呢？每个线程在创建后，都会产生自己的程序计数器和栈帧，程序计数器在各个线程之间互不影响。


###  2.2 CPU时间片
CPU时间片即CPU分配各各个程序的时间，每个线程被分配一个时间段。称作它的时间片。<br />在宏观上：我们可以同时打开多个应用程序，每个程序并行不悖，同时运行。 但在微观上：由于只有一个CPU，一次只能处理程序要求的一部分，如何处理公平，一种方法就是引入时间片，每个程序轮流执行。<br />



**并行与并发**



并行：同一时间多个线程同时执行；  ——————>vs (串行)<br />

并发：一个核快速切换多个线程，让它们依次执行，看起来像并行，实际上是并发